# nginx <%= @app %> php application partial
#
# Generated by Chef for <%= node[:fqdn] %>
# Local modifications will be overwritten.
#

<% if @mount_path.empty? -%>
root                  <%= @docroot %>;
<% end -%>

<% if @mount_path.empty? -%>
index                 index.php index.html index.htm;
<% else -%>
location <%= @mount_path %> {
  index               index.php index.html index.htm;
}
<% end -%>

location ~ \.php$ {
  fastcgi_pass      127.0.0.1:9000;
  fastcgi_index     index.php;
  fastcgi_param     SCRIPT_FILENAME <%= @docroot %>/$fastcgi_script_name;
  fastcgi_param     PATH_INFO       $fastcgi_script_name;
  include           fastcgi_params;
}

if (-f $document_root<%= @mount_path %>/system/maintenance.html) {
  rewrite ^(.*)$ <%= @mount_path %>/system/maintenance.html break;
}
